-- Reference time
arki.year = grib.year
arki.month = grib.month
arki.day = grib.day
arki.hour = grib.hour
arki.minute = grib.minute
arki.second = grib.second

-- Run
arki.run_hour = grib.hour
arki.run_minute = grib.minute

-- Origin
arki.centre = grib.identificationOfOriginatingGeneratingCentre
arki.subcentre = grib.identificationOfOriginatingGeneratingSubCentre
arki.processtype = grib.typeOfGeneratingProcess
arki.bgprocessid = grib.backgroundGeneratingProcessIdentifier
arki.processid = grib.generatingProcessIdentifier

-- Product
arki.discipline = grib.discipline
arki.category = grib.parameterCategory
arki.number = grib.parameterNumber

-- Level
-- TODO
arki.ltype1  = grib.typeOfFirstFixedSurface
arki.lscale1 = grib.scaleFactorOfFirstFixedSurface
arki.lvalue1 = grib.scaledValueOfFirstFixedSurface
if grib.typeOfSecondFixedSurface and grib.typeOfSecondFixedSurface ~= 255 then
	arki.ltype2 =  grib.typeOfSecondFixedSurface
	arki.lscale2 = grib.scaleFactorOfSecondFixedSurface
	arki.lvalue2 = grib.scaledValueOfSecondFixedSurface
end

-- Time range
if grib.typeOfStatisticalProcessing then
	arki.ptype = grib.typeOfStatisticalProcessing
else
	arki.ptype = 0
end
arki.punit = 254 -- seconds
arki.p1 = (grib.endStepInHours - grib.startStepInHours) * 3600
arki.p2 = grib.endStepInHours * 3600

function norm_lon(lon)
	if lon > 180 then
		return lon - 360
	else
		return lon
	end
end

-- Bounding box
if grib.latitudeOfFirstGridPointInDegrees ~= nil then
	arki.latmin = grib.latitudeOfFirstGridPointInDegrees
	arki.latmax = grib.latitudeOfLastGridPointInDegrees
	arki.lonmin = norm_lon(grib.longitudeOfFirstGridPointInDegrees)
	arki.lonmax = norm_lon(grib.longitudeOfLastGridPointInDegrees)
end

-- Area
arki.area.type = grib.gridDefinitionTemplateNumber

arki.area.latfirst = grib.latitudeOfFirstGridPointInDegrees
arki.area.lonfirst = grib.longitudeOfFirstGridPointInDegrees

if grib.numberOfPointsAlongAParallel then
	arki.area.Ni = grib.numberOfPointsAlongAParallel
	arki.area.Nj = grib.numberOfPointsAlongAMeridian
	arki.area.latlast = grib.latitudeOfLastGridPointInDegrees
	arki.area.lonlast = grib.longitudeOfLastGridPointInDegrees
end
if grib.numberOfPointsAlongXAxis then
	arki.area.Ni = grib.numberOfPointsAlongXAxis
	arki.area.Nj = grib.numberOfPointsAlongYAxis
end
if grib.angleOfRotationInDegrees then
	arki.area.rot = grib.angleOfRotationInDegrees
	arki.area.latp = latitudeOfSouthernPoleInDegrees
	arki.area.lonp = longitudeOfSouthernPoleInDegrees
end


-- Ensemble
if grib.typeOfProcessedData >= 3 and grib.typeOfProcessedData <= 5 then
	arki.ensemble.ty = grib.typeOfEnsembleForecast
	arki.ensemble.pf = grib.perturbationNumber
	arki.ensemble.tf = grib.numberOfForecastsInEnsemble
	if grib.derivedForecast then
		arki.ensemble.d = grib.derivedForecast
	end
end
