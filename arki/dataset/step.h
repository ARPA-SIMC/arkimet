#ifndef ARKI_DATASET_STEP_H
#define ARKI_DATASET_STEP_H

/// Compute names for segments in an arkimet dataset

#include <string>
#include <vector>

namespace arki {
class Metadata;
class ConfigFile;

namespace types {
class Time;
}

namespace matcher {
class OR;
}

namespace dataset {

/**
 * Generator for filenames the dataset in which to store a metadata
 */
struct Step
{
    virtual ~Step() {}
    virtual std::string operator()(const Metadata& md) = 0;

    /**
     * Get the timespan of a file by just looking at its path.
     *
     * Returns true if the path could be recognised, and false if it does not
     * look like path has been generated by this Step.
     */
    virtual bool path_timespan(const std::string& path, types::Time& start_time, types::Time& end_time) const = 0;

    /**
     * Check if a given path (even a partial path) can contain things that
     * match the given matcher.
     *
     * Currently it can only look at the reftime part of the matcher.
     */
    virtual bool pathMatches(const std::string& path, const matcher::OR& m) const = 0;

    /**
     * Create a TargetFile according to the given configuration.
     *
     * Returns nullptr if no 'step' was requested in the configuration.
     *
     * Usually, only the 'step' configuration key is considered.
     */
    static Step* create(const ConfigFile& cfg);

    /**
     * Return the list of available steps
     */
    static std::vector<std::string> list();
};

}
}
#endif
