# iseg datasets

This dataset contains [segments](segments.md) with an index next to each
segment, with a `.index` extension, containing a SQLite database.

It can enforce detection of duplicates, enforcing uniqueness on the set of
metadata selected with the `unique` configuration keyword.

Duplicate detection relies on the invariant that segment naming produces
segments that do not overlap, so a datum can only be found in a well defined
segment, and duplicate detection can be performed on a per-segment basis.

`iseg` datasets do not have one global index, and enumerating the segments in
the dataset is done by enumerating all the possible segments that would be
generated by the dataset step within the time range defined by the query and
the range of data present in the dataset. This means that `iseg` datasets will
ignore all segments that do not fit in the naming scheme defined by the dataset
step.

It can optimize queries that use metadata selected with the `index`
configuration keyword.

## Dataset layout

The `.index` files contain the metadata for all data in the segment.

The `.index` file contains additional indices for the metadata listed in the
`unique` configuration value, to do quick duplicate detection, and extra
indices for the metadata listed in the `index` configuration value.


## Check and repack on concat segments

### During check

{{testdoc("arki_dataset_iseg_maintenance_grib.check_*")}}

### During --accurate check

{{testdoc("arki_dataset_iseg_maintenance_grib.tcheck_*")}}

### During fix

{{testdoc("arki_dataset_iseg_maintenance_grib.fix_*")}}

### During repack

{{testdoc("arki_dataset_iseg_maintenance_grib.repack*")}}


## Check and repack on dir segments

### During check

{{testdoc("arki_dataset_iseg_maintenance_grib_dirs.check*")}}

### During --accurate check

{{testdoc("arki_dataset_iseg_maintenance_grib_dirs.tcheck*")}}

### During fix

{{testdoc("arki_dataset_iseg_maintenance_grib_dirs.fix*")}}

### During repack

{{testdoc("arki_dataset_iseg_maintenance_grib_dirs.repack*")}}
