--[[ Composing match expressions

An arkimet matcher is composed of various match expressions, grouped by
metadata type. Each group is separated by ';' or by a newline. All groups must
be satisfied for the matcher to match.

Each group contains one or more type-specific match expression, separated by
" or ". All expressions inside a group are ORed together, which means that only
one of them must be true for the group to match.

It is possible to do, for example:

  origin:arpa or GRIB1,98,0; product:t or z

This matches data which are from Arpa or ECMWF, and whose product is
temperature or geopotential.

It is not possible to say "this origin OR this product": only expressions
inside the same group can be ORed together.

]]

local sample = arki.metadata.new()
sample:set(arki_origin.grib1(200, 0, 0))
sample:set(arki_product.grib1(98, 128, 167))
sample:set(arki_level.grib1(1))

ensure_matches(sample, "origin:arpa")
ensure_matches(sample, "origin:arpa or GRIB1,98,0")
ensure_matches(sample, "origin:arpa; product:t")
ensure_matches(sample, "origin:GRIB1,200; product:t or z")
ensure_matches(sample, [[
origin:arpa
product:t
level:g00 or g02
]])
